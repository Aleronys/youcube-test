asyncapi: 2.4.0
info:
  title: YouCube
  version: 0.0.poc0
  description: |
    Documentation for YouCube's backend API.

    All public servers are set by default in the client. \
    The client will choose the best automatically.
  license:
    name: GLP-3.0
    url: "https://github.com/Commandcracker/YouCube/blob/main/LICENSE.txt"
  contact:
    name: Github
    url: https://github.com/Commandcracker/YouCube

servers:
  public-primary:
    url: ws://oxygen.knijn.one:5000
    protocol: ws
    description: |
      **Primary Public Server**

      Hosted on [voxvm](https://voxvm.com/) in [New York City](https://duckduckgo.com/?t=ffab&q=New+York+City&ia=web&iax=about&iaxm=maps) by [EmmaKnijn](https://knijn.one/)

      This server is pretty quick and slick. \
      Thats also a reason, why this server is the primary one.
  public-fallback:
    url: wss://youcube.onrender.com
    protocol: wss
    description: |
      **Public Fallback Server**

      Hosted on [render](https://render.com/) in [Oregon (US West)](https://duckduckgo.com/?t=ffab&q=Oregon+(US+West)&ia=web&iaxm=about&iax=images) by [Commandcracker](https://github.com/Commandcracker)

      This server is only meant to be used when the primary server is offline. \
      It's pretty slow, but it should do the job.

defaultContentType: application/json
channels:
  /:
    subscribe:
      description: "Messages the Server Can Process"
      message:
        oneOf:
          - $ref: "#/components/messages/request_media"
          - $ref: "#/components/messages/get_chunk"
    publish:
      description: "Messages the Server Can Return"
      message:
        oneOf:
          - $ref: "#/components/messages/error"
          - $ref: "#/components/messages/chunk"
          - $ref: "#/components/messages/media"

components:
  messages:
    request_media:
      payload:
        type: object
        additionalProperties: false
        properties:
          action:
            type: string
            description: The action that should be performed
            enum:
              - "request_media"
          url:
            type: string
            description: Url or Search Term
            examples:
              - "Never Gonna Give You Up"
              - "dQw4w9WgXcQ"
        required:
          - action
          - url

    get_chunk:
      payload:
        type: object
        additionalProperties: false
        properties:
          action:
            type: string
            description: The action that should be performed
            enum:
              - "get_chunk"
          chunkindex:
            type: integer
            minimum: 0
            description: Index of the next chunk
          id:
            type: string
            pattern: ^[a-zA-Z0-9-_]*$
            description: Media id
            example: "dQw4w9WgXcQ"
        required:
          - action
          - chunkindex
          - id

    error:
      payload:
        type: object
        additionalProperties: false
        properties:
          action:
            type: string
            description: The action that should be performed
            enum:
              - "error"
          message:
            type: string
            description: The error message
            example: "You dare not use special Characters"
        required:
          - action
          - message

    chunk:
      payload:
        type: object
        description: 1 chunk is 16 * 1024 bits
        additionalProperties: false
        example: "ªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªª ..."

    media:
      payload:
        type: object
        additionalProperties: true
        properties:
          action:
            type: string
            description: The action that should be performed
            enum:
              - "media"
          id:
            type: string
            pattern: ^[a-zA-Z0-9-_]*$
            description: The media id
            example: "dQw4w9WgXcQ"
          title:
            type: string
            description: The title of the media
            example: "Never Gonna Give You Up"
          like_count:
            type: integer
            description: The like count of the media
            example: 15526549
            minimum: 0
          view_count:
            type: integer
            description: The view count of the media
            example: 1307201506
            minimum: 0
          playlist_videos:
            type: array
            description: The view count of the media
            items:
              type: string
              additionalProperties: true
              pattern: ^[a-zA-Z0-9-_]*$
              description: The media id
              example:
                - "CVsbTCdTyAM"
                - "xm3YgoEiEDc"
        required:
          - action
          - id
          - title
          - like_count
          - view_count
